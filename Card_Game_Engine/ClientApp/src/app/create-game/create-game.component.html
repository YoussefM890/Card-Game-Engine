<div class="create-game-container">
  <app-nav [parentComponent]="'create-game'"></app-nav>
  <div class="create-game-content">
    <!-- Left Panel: Rules Editor -->
    <div class="panel rules-panel">
      <div class="panel-header sticky-top">
        <div class="header-actions">
          <button (click)="onSubmit()" class="submit-btn" color="accent" mat-raised-button>
            <mat-icon>save</mat-icon>
            <span class="hide-mobile">Submit</span>
          </button>
        </div>
        <div class="header-actions">
          <button (click)="openEditPlayers()" class="action-btn" color="primary" mat-raised-button>
            <mat-icon>people</mat-icon>
            <span class="hide-mobile">Players</span>
          </button>
          <button (click)="addManualTrigger()" class="action-btn" color="primary" mat-raised-button>
            <mat-icon>touch_app</mat-icon>
            <span class="hide-mobile">{{ manualTriggersArray.length === 0 ? 'Add' : 'Edit' }} Triggers</span>
          </button>
          <button (click)="importRules()" class="action-btn" color="primary" mat-raised-button>
            <mat-icon>upload</mat-icon>
            <span class="hide-mobile">Import</span>
          </button>
        </div>
      </div>

      <div class="panel-body">
        <form [formGroup]="gameForm">
          @if (playersArray.controls.length > 0) {
            <div class="info-section">
              <div class="section-label">
                <mat-icon>people</mat-icon>
                <span>Players</span>
              </div>
              <mat-chip-set class="chip-set">
                @for (trigger of playersArray.value; track trigger.id) {
                  <mat-chip
                    [ngStyle]="getPlayersStyles(trigger)"
                    [matTooltip]="trigger.description"
                  >{{ trigger.role }}
                  </mat-chip>
                }
              </mat-chip-set>
            </div>
          }

          @if (manualTriggersArray.controls.length > 0) {
            <div class="info-section">
              <div class="section-label">
                <mat-icon>touch_app</mat-icon>
                <span>Manual Triggers</span>
              </div>
              <mat-chip-set class="chip-set">
                @for (trigger of manualTriggersArray.value; track trigger.id) {
                  <mat-chip
                    [ngStyle]="getManualTriggerStyles(trigger)"
                    [matTooltip]="trigger.description"
                  >{{ trigger.name }}
                  </mat-chip>
                }
              </mat-chip-set>
            </div>
          }

          <div class="rules-list" formArrayName="rules">
            @for (ruleCtrl of rules.controls; track ruleCtrl; let i = $index) {
              <div class="rule-item animate-fade-in">
                <app-rule [ruleForm]="convertToFormGroup(ruleCtrl)"></app-rule>
                <button (click)="removeRule(i)" class="remove-btn" color="warn" mat-button>
                  <mat-icon>delete</mat-icon>
                  Remove Rule
                </button>
              </div>
            }
          </div>

          <button (click)="addRule()" class="add-rule-btn" mat-raised-button>
            <mat-icon>add</mat-icon>
            Add Rule
          </button>
        </form>
      </div>
    </div>

    <!-- Center Panel: Settings -->
    <div class="panel settings-panel">
      <div class="settings-section">
        <div class="section-title">
          <mat-icon>view_module</mat-icon>
          <span>Grid Settings</span>
        </div>
        <p class="section-description">Configure the game board dimensions and cell visibility</p>

        <div class="dimension-controls">
          <div class="dimension-row">
            <div class="dimension-label">
              <mat-icon>swap_horiz</mat-icon>
              <span>Width</span>
              <span class="dimension-value">{{ widthControl.value }}</span>
            </div>
            <div class="dimension-buttons">
              <button (click)="changeWidth(-1)" color="primary" mat-mini-fab>
                <mat-icon>remove</mat-icon>
              </button>
              <button (click)="changeWidth(1)" color="primary" mat-mini-fab>
                <mat-icon>add</mat-icon>
              </button>
            </div>
          </div>

          <div class="dimension-row">
            <div class="dimension-label">
              <mat-icon>swap_vert</mat-icon>
              <span>Height</span>
              <span class="dimension-value">{{ heightControl.value }}</span>
            </div>
            <div class="dimension-buttons">
              <button (click)="changeHeight(-1)" color="primary" mat-mini-fab>
                <mat-icon>remove</mat-icon>
              </button>
              <button (click)="changeHeight(1)" color="primary" mat-mini-fab>
                <mat-icon>add</mat-icon>
              </button>
            </div>
          </div>
        </div>

        <div class="visibility-section">
          <div class="section-subtitle">Cell Visibility</div>
          <div class="visibility-buttons">
            @for (visibility of visibilityOptions; track visibility.value) {
              <button
                (click)="selectedVisibilityOption = visibility"
                [class.selected]="selectedVisibilityOption.value === visibility.value"
                [style.background-color]="visibility.background"
                [style.color]="visibility.color"
                class="visibility-btn"
                mat-raised-button
              >
                {{ visibility.display }}
              </button>
            }
          </div>
        </div>
      </div>

      <div class="grid-preview">
        <div class="section-title">
          <mat-icon>grid_on</mat-icon>
          <span>Grid Preview</span>
        </div>
        <app-grid
          (cellClick)="changeCellVisibility($event)"
          [cols]="widthControl.value"
          [displayCellIndex]="true"
          [itemStyles]="itemStyles"
          [rows]="heightControl.value"
          class="preview-grid"
        ></app-grid>
      </div>
    </div>

    <!-- Right Panel: Card Selection -->
    <div class="panel cards-panel">
      <div class="section-title">
        <mat-icon>style</mat-icon>
        <span>Card Selection</span>
      </div>
      <p class="section-description">Select cards to include in your deck</p>

      <div class="selected-cards-container">
        <app-card-line (cardSelected)="onCardSelectedFromLine($event)" [cards]="selectedCards"></app-card-line>
      </div>

      <div [formGroup]="suitsForm" class="suits-section">
        <div class="section-subtitle">Suits</div>
        <div class="suits-grid" formArrayName="suits">
          @for (suitControl of suitsFormArray.controls; track suitControl.value) {
            <mat-checkbox [formControlName]="$index" class="suit-checkbox" color="primary">
              {{ suits[$index].display }}
            </mat-checkbox>
          }
        </div>
      </div>

      <div class="values-section">
        <div class="section-subtitle">Card Values</div>
        <app-grid
          (cellClick)="onValueSelected($event)"
          [cols]="7"
          [displayCellIndex]="true"
          [rows]="2"
          [list]="distinctCardsValues"
          class="values-grid"
        ></app-grid>
      </div>
    </div>
  </div>
</div>
