<mat-grid-list cols="2" rowHeight="49.9%">
  <mat-grid-tile class="overflow-auto" rowspan="2">
    <div class="form-container">
      <form [formGroup]="gameRuleForm">
        <div formArrayName="rules">
          @for (ruleCtrl of rules.controls; track ruleCtrl; let i = $index) {
            <div [formGroup]="convertToFormGroup(ruleCtrl)" class="rule">
              <mat-form-field appearance="fill" class="w-100">
                <mat-label>Trigger</mat-label>
                <mat-select formControlName="trigger" (selectionChange)="updateTriggerParameters(ruleCtrl)">
                  @for (trigger of triggers; track trigger.id) {
                    <mat-option [value]="trigger.id">{{ trigger.display }}</mat-option>
                  }
                </mat-select>
              </mat-form-field>
              <div formArrayName="parameters" class="parameters">
                @for (paramCtrl of getParameters(i).controls; track paramCtrl.value.id; let k = $index) {
                  <app-parameter [parentForm]="convertToFormGroup(ruleCtrl)"
                                 [parameterForm]="convertToFormGroup(paramCtrl)"
                                 [availableParameters]="triggerParameters"
                  ></app-parameter>
                }
              </div>
              <button mat-button (click)="addParameter(i)">Add Parameter</button>
              <button mat-button color="warn" (click)="removeRule(i)">Remove Rule</button>
              <div formArrayName="actions">
                @for (actionCtrl of getActions(i).controls; track actionCtrl; let j = $index) {
                  <app-action [ruleForm]="convertToFormGroup(ruleCtrl)"
                              [actionForm]="convertToFormGroup(actionCtrl)"
                              [actionIndex]="j"
                  >
                  </app-action>
                }
              </div>
              <button mat-button (click)="addAction(i)">Add Action</button>
            </div>
          }
        </div>
        <button mat-raised-button color="primary" (click)="addRule()">Add Rule</button>
        <button mat-raised-button color="accent" (click)="onSubmit()">Submit</button>
      </form>
    </div>
  </mat-grid-tile>
  <mat-grid-tile>
    <div class="w-100 h-100">
      <button (click)="importRules()" color="warn" mat-raised-button>Import Rules</button>
    </div>
  </mat-grid-tile>
  <mat-grid-tile>
    <app-grid class="center max ghost-cards"></app-grid>
  </mat-grid-tile>
</mat-grid-list>
