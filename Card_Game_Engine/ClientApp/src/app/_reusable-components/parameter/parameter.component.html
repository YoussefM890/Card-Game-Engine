<div [formGroup]="parameterForm" class="parameter">
  <mat-form-field appearance="outline" class="compact-field param-select">
    <mat-select (selectionChange)="onParameterChange($event.value)" formControlName="id" placeholder="Parameter...">
      @for (parameter of availableParameters; track parameter.id) {
        <mat-option [matTooltip]="parameter.description" [value]="parameter.id">{{ parameter.display }}</mat-option>
      }
    </mat-select>
  </mat-form-field>

  @if (selectedParameter) {
    <mat-form-field appearance="outline" class="compact-field value-field">
      @switch (selectedParameter.type) {
        @case (types.Text) {
          <input formControlName="value" matInput placeholder="Value...">
        }
        @case (types.Select) {
          <mat-select formControlName="value" placeholder="Value...">
            @if (Array.isArray(selectedParameter.args)) {
              @for (option of selectedParameter.args; track option.value) {
                <mat-option [matTooltip]="option.description" [value]="option.value">{{ option.display }}</mat-option>
              }
            }
          </mat-select>
        }
        @case (types.Positions) {
          <input formControlName="value" matInput placeholder="Positions...">
          <button (click)="openPositionsSelectorModal($event)" class="suffix-btn" mat-icon-button matSuffix>
            <mat-icon>grid_on</mat-icon>
          </button>
        }
        @case (types.Filter) {
          <input formControlName="value" matInput placeholder="Filter..." readonly>
          <button (click)="openFilterSelectorModal($event)" class="suffix-btn" mat-icon-button matSuffix>
            <mat-icon>filter_list</mat-icon>
          </button>
        }
        @case (types.Formula) {
          <input formControlName="value" matInput placeholder="Formula...">
          <button (click)="openFormulaBuilderModal($event)" class="suffix-btn" mat-icon-button matSuffix>
            <mat-icon>functions</mat-icon>
          </button>
        }
        @case (types.MultiSelect) {
          <mat-select (selectionChange)="onMultiSelectChange($event.value)" [value]="displayValue" multiple
                      placeholder="Values...">
            @if (Array.isArray(selectedParameter.args)) {
              @for (option of selectedParameter.args; track option.value) {
                <mat-option [matTooltip]="option.description" [value]="option.value">{{ option.display }}</mat-option>
              }
            }
          </mat-select>
        }
      }
    </mat-form-field>
  }
</div>
