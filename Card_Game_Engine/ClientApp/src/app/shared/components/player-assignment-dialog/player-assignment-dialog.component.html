<div class="player-assignment-dialog">
  <app-dialog-header icon="people" title="Assign Players"></app-dialog-header>

  <mat-dialog-content>
    <!-- Participants List -->
    <div class="section">
      <h3>Room Participants</h3>
      <mat-list>
        @for (participant of participants; track participant.userId) {
          <mat-list-item class="participant-item">
            <div class="participant-row">
              <!-- User Info -->
              <div class="user-info">
                <mat-icon matListItemIcon>person</mat-icon>
                <div matListItemTitle class="user-details">
                  <span [title]="participant.userName" class="user-name">
                    {{ participant.userName }}
                  </span>
                  @if (participant.isRoomOwner) {
                    <mat-chip class="owner-chip">ADMIN</mat-chip>
                  }
                </div>
              </div>

              <!-- Player Assignment -->
              <div class="assignment-controls">
                <mat-form-field appearance="outline" class="player-select">
                  <mat-label>Assign to Player</mat-label>
                  <mat-select [value]="getAssignment(participant.userId)"
                              (selectionChange)="onAssignmentChange(participant.userId, $event.value)">
                    <mat-option [value]="null">
                      <mat-icon>visibility</mat-icon>
                      <span style="margin-left: 8px;">Spectator</span>
                    </mat-option>
                    @for (player of getAvailablePlayersForUser(participant.userId); track player.id) {
                      <mat-option [value]="player.id">
                        <mat-icon>sports_esports</mat-icon>
                        <span style="margin-left: 8px;">{{ player.role }}</span>
                      </mat-option>
                    }
                  </mat-select>
                </mat-form-field>
              </div>
            </div>
          </mat-list-item>
          <mat-divider></mat-divider>
        }
      </mat-list>

      @if (participants.length === 0) {
        <div class="empty-state">
          <mat-icon>info</mat-icon>
          <p>No users in the room yet</p>
        </div>
      }
    </div>

    <!-- Available Players -->
    @if (allPlayers.length > 0) {
      <div class="section available-players-section">
        <h3>Available Players ({{ allPlayers.length }})</h3>
        <div class="available-players-grid">
          @for (player of allPlayers; track player.id) {
            <div [title]="player.description || player.role"
                 class="available-player-card">
              <mat-icon>sports_esports</mat-icon>
              <div class="player-info">
                <span class="player-role">{{ player.role }}</span>
                @if (player.description) {
                  <span class="player-desc">{{ player.description }}</span>
                }
              </div>
            </div>
          }
        </div>
      </div>
    }

    <!-- Assignment Summary -->
    <div class="section summary-section">
      <div class="summary-card">
        <div class="summary-item" title="Total users in the room">
          <mat-icon>people</mat-icon>
          <span>{{ participants.length }} User{{ participants.length === 1 ? '' : 's' }}</span>
        </div>
        <div class="summary-item" title="Users assigned to play">
          <mat-icon>sports_esports</mat-icon>
          <span>{{ getAssignedCount() }} Assigned</span>
        </div>
        <div class="summary-item" title="Users watching as spectators">
          <mat-icon>visibility</mat-icon>
          <span>{{ getSpectatorCount() }} Spectator{{ getSpectatorCount() === 1 ? '' : 's' }}</span>
        </div>
      </div>
    </div>
  </mat-dialog-content>

  <mat-dialog-actions align="end">
    <button (click)="onSave()"
            color="accent"
            mat-raised-button>
      <mat-icon>check</mat-icon>
      Save & Apply
    </button>
  </mat-dialog-actions>
</div>
